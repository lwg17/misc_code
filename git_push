#!/usr/bin/env bash
# git_push
# Usage: git_push <file> [repository]
# Default repository: misc_code

set -euo pipefail

FILE="${1:-}"
REPO="${2:-misc_code}"

if [[ -z "$FILE" ]]; then
  echo "Usage: git_push <file> [repository]"
  exit 1
fi

REPO_PATH="$HOME/$REPO"

if [[ ! -d "$REPO_PATH/.git" ]]; then
  echo "Error: $REPO_PATH is not a git repository"
  exit 2
fi

# Copy file into repo if not already there
if [[ ! -f "$REPO_PATH/$(basename "$FILE")" ]]; then
  cp "$FILE" "$REPO_PATH/"
fi

cd "$REPO_PATH"

# Stage, commit, push
git add "$(basename "$FILE")"
git commit -m "Update $(basename "$FILE")"
git pull --rebase origin main || true
git push origin main

echo "âœ… Pushed $(basename "$FILE") to $REPO (main branch)"
